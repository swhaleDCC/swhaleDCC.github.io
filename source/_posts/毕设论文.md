title: '[加密文章]毕设笔记'
tags:
  - 毕设笔记
categories:
  - 毕设
password: 199812
date: 2019-09-25 19:49:00
---
>友链:
https://github.com/maoqyhz/DroidCC

<!--more-->


# 用机器学习检测Android恶意代码
发现了一个写的很详细的博客：[用机器学习检测Android恶意代码](http://www.vuln.cn/7012)，做个笔记。

1. 安卓恶意代码检测方法
	- 基于特征代码的检测方法，通过检测文件是否拥有已知恶意软件的特征代码(如一段特殊代码或字符串)来判断其是否为恶意软件。它的优点是快速、准确率高、误报率低，但是无法检测未知的恶意代码。
	- 基于行为的分析方法又分为动态分析方法和静态分析方法，依靠监视程序的行为与已知的恶意行为模式进行匹配，以此判断目标文件是否具备恶意特征。它的优点可以检测未知的恶意代码变种，缺点是误报率较高。
		- 动态分析方法是指利用“沙盒或模拟器”来模拟运行程序，通过监控或者拦截的方式分析程序运行的行为，但是很消耗资源和时间。
		- 静态分析方法则是通过逆向手段抽取程序的特征，分析其中指令序列等。本文采用静态分析的方法进恶意行代码检测。
        
2. Weka与机器学习的分类算法
Weka（Waikato Environment for Knowledge Analysis），是一款免费的，非商业化基于JAVA环境下开源的机器学习（machine learning）以及数据挖掘（data minining）软件。Weka存储数据的格式是ARFF（Attribute-Relation File Format）文件，是一种ASCII文本文件。本文就是将特征数据生成ARFF格式的文件，利用Weka自带的分类算法进行数据训练与模型测试。
机器学习中分为有监督学习与无监督学习。有监督学习就是根据训练集，用学习算法学习出一个模型，然后可以用测试集对模型进行评估准确度和性能。分类算法属于有监督学习，需要先建立模型。常见的分类算法有：随机森林(Random Forest)、支持向量机(SVM)等。

3. APK的基本格式
APK文件格式是一种基于ZIP的格式，它与JAR文件的构造方式相似。参考：https://en.wikipedia.org/wiki/Android_application_package
一个APK文件通常包含以下文件：
	- classes.dex: Dalvik字节码,可被Dalvik虚拟机执行。（需要重点注意，安卓的执行代码被编译后封装在这个文件中。）
	- AndroidManifest.xml: 一个的Android清单文件，用于描述该应用程序的名字、版本号、所需权限、注册的服务、链接的其他应用程序。该文件使用XML文件格式。
	- META-INF 文件夹: 下面有3个文件
		- MANIFEST.MF: 清单信息
		- CERT.RSA: 保存应用程序的证书和授权信息
		- CERT.SF: 保存SHA-1信息资源列表
	- res: APK所需要的资源文件夹
	- assets: 不需编译的原始资源文件目录
	- resources.arsc:编译后的二进制资源文件
	- lib:库文件目录

4. Dalvik虚拟机与反汇编
区别与JAVA虚拟机(JVM)，安卓的虚拟机称为Dalvik虚拟机（DVM）。Java虚拟机运行的是Java字节码，Dalvik虚拟机运行的是Dalvik字节码。Java虚拟机基于栈架构，Dalvik虚拟机基于寄存器架构。
DVM拥有专属的DEX可执行文件格式和指令集代码。smali和baksmali 则是针对DEX执行文件格式的汇编器和反汇编器，反汇编后DEX 文件会产生.smali 后缀的代码文件，smali代码拥有特定的格式与语法，smali语言是对Dalvik 虚拟机字节码的一种解释。

5. 恶意代码模型
![upload successful](/images/pasted-24.png)
测试恶意代码检测模型
![upload successful](/images/pasted-25.png)

# 《Android恶意代码分析与渗透测试》

![upload successful](/images/pasted-33.png)

1. Android基本概念
	- dalvik虚拟机（使用dex编译器进行转换，生成位元码后运行）
	- jvm虚拟机（Java虚拟机）
    
2. Android应用程序诊断环境
wireshark
ADB（Android debug bridge）
设置点对点网络
AP：access point 接入点
tcpdump二进制文件
UNIX分析工具包 busybox
pm：package manager
logcat：adb logcat
adb pull xxx.apk  ：导出到本地PC
dex文件：分析工具010编辑器
```
adb devices：显示所有设备的信息
adb shell：进入shell命令模式
adb -s emulator-5554 shell：指定设备进入shell命令模式
adb install xxx.apk
adb shell ls /data/data 浏览设备中文件夹进行查找已安装软件包
adb uninstall 包名
```

3. Android APP分析方法
dex2jar
JD-GUI
androguard
droidbox
sublime插件
apkInspector（不支持ubantu12.04以上）
dexplorer、dexdump（Google play store）
santoku live CD

4. 恶意代码分析
在线分析工具：Anubis、virustotal、andrototal、apkscan APP、Dexter、apkanalyzer

6. 使用Android诊断工具
packetshark：网络数据包截获工具（Google play store）
drozer：移动诊断框架
ASEF：移动设备漏洞工具
droidsheep：web会话截取工具

7. Android APP试题
查找APP的密钥
Hex编辑器
最强大的调试工具：ida pro
Google safe browsing
OWASP TOP 10
Androidlab：虚拟手机银行程序